ğŸ¯ The Magic of Nginx as a Reverse Proxy
Understanding the Problem First
BROWSER (Your Computer)          AZURE APP SERVICE
    â”‚                                   â”‚
    â”‚  "Give me the iframe"            â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º   â”‚
    â”‚                                   â”‚
    â”‚  "Here: http://mermaid:8080"     â”‚
    â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
    â”‚                                   â”‚
    â”‚  "What?? I can't reach that!" âŒ  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
How Nginx Changes Everything
BROWSER                 AZURE APP SERVICE (with Nginx)
    â”‚                           â”‚
    â”‚  "GET /editor/"          â”‚
    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º     â”‚ (Port 443 HTTPS)
    â”‚                          â”‚
    â”‚                      â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚                      â”‚ NGINX  â”‚ "Ah, /editor/ means mermaid:8080"
    â”‚                      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚                          â”‚ 
    â”‚                      â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚  MERMAID   â”‚ (Internal port 8080)
    â”‚                      â”‚  SERVICE   â”‚
    â”‚                      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                          â”‚
    â”‚  "Here's the content"     â”‚
    â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚ (Still HTTPS to browser!)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ğŸ”§ Detailed Nginx Flow
1. Browser Makes Request
Browser: "GET https://yourapp.azurewebsites.net/editor/"
2. Nginx Receives and Routes
nginxserver {
    listen 80;  # Azure translates this to 443 (HTTPS)
    
    location /editor/ {
        # Nginx speaks to internal service
        proxy_pass http://mermaid:8080/;
    }
}
3. Internal Communication
Nginx â†’ Mermaid: "GET http://mermaid:8080/"
Mermaid â†’ Nginx: "Here's the HTML content"
4. Nginx Returns to Browser
Nginx â†’ Browser: "Here's your content" (via HTTPS!)
ğŸ­ The Key Transformation
What the Browser Sees:
html<!-- In your Streamlit page -->
<iframe src="/editor/"></iframe>
<!-- This becomes: https://yourapp.azurewebsites.net/editor/ -->
What Actually Happens Inside:
/editor/ â†’ nginx â†’ http://mermaid:8080/
         â†‘        â†‘
    Public path   Internal Docker network
ğŸ“Š Nginx Acts as a Translator
Browser SeesNginx Translates ToWhy It Workshttps://app.azure.com/http://streamlit:8501Internal HTTP is hiddenhttps://app.azure.com/editor/http://mermaid:8080Browser only sees HTTPSSame domain, same protocolDifferent internal servicesNo mixed content!
ğŸ” Breaking Down the Solution
Problem 1: Mixed Content
Before: HTTPS page â†’ HTTP iframe âŒ
After:  HTTPS page â†’ HTTPS iframe âœ… (same domain!)
Problem 2: Internal Names
Before: Browser tries to reach "mermaid:8080" âŒ
After:  Browser reaches "/editor/" on same domain âœ…
ğŸ’¡ The Complete Picture
yaml# Docker Compose Internal Network
services:
  nginx:      # Public face (port 80/443)
  streamlit:  # Internal only (port 8501)
  mermaid:    # Internal only (port 8080)
Browser never knows about internal services!
ğŸ¯ Think of Nginx Like a Restaurant

Customer (Browser): "I'll have the special" (/editor/)
Waiter (Nginx): Takes order to kitchen
Kitchen (Mermaid on port 8080): Prepares the food
Waiter (Nginx): Brings food to customer
Customer never enters the kitchen or knows how it works!

ğŸ“ The Critical Points

Single External Endpoint: Everything goes through nginx
Protocol Consistency: Browser always uses HTTPS
Path-Based Routing: / â†’ Streamlit, /editor/ â†’ Mermaid
Internal Communication: Services talk HTTP internally (safe inside Docker)
No Direct Access: Browser never directly contacts internal services

This is why nginx is called a "reverse proxy" - it takes external requests and proxies them in reverse to internal services!RetryClaude can make mistakes. Please double-check responses.Research Opus 4
